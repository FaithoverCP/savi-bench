<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAVI Benchmarks</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header>
    <h1>
      <span class="status">
        <span id="status-dot" class="status-dot" style="display:inline-block;width:12px;height:12px;border-radius:50%;background:#95a5a6;vertical-align:middle"></span>
        <span id="status-text" class="status-text">Status: loading</span>
      </span>
      SAVI Benchmarks
    </h1>
    <p class="sub">Live hourly results with phase breakdown & competition highlights.</p>
  </header>

  <main>
    <section class="cards" id="summary">
      <div class="card"><h3>Total Runs (24h)</h3><div class="num" id="totalRuns">—</div></div>
      <div class="card"><h3>Pass Rate</h3><div class="num" id="passRate">—</div></div>
      <div class="card"><h3>Avg Score</h3><div class="num" id="avgScore">—</div></div>
      <div class="card"><h3>Last Phase</h3><div class="num" id="lastPhase">—</div></div>
    </section>

    <section>
      <h2>Phase Breakdown (24h)</h2>
      <table id="phaseTable">
        <thead><tr><th>Phase</th><th>Runs</th><th>Pass %</th><th>Avg Score</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section>
      <h2>Best Competition Run</h2>
      <pre id="bestComp">No data yet.</pre>
    </section>

    <section>
      <h2>Notes</h2>
      <ul>
        <li>Runner pushes <code>data/agi_benchmark_log.json</code> hourly.</li>
        <li>If you see “No data yet”, refresh after the next run.</li>
      </ul>
    </section>
  </main>

  <footer><small>© SAVI — auto-updates hourly.</small></footer>

<script>
async function loadData() {
  try {
    const res = await fetch('data/agi_benchmark_log.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('Missing data file');
    const log = await res.json();
    if (!Array.isArray(log) || !log.length) throw new Error('Empty log');

    const now = Date.now(), dayAgo = now - 24*3600*1000;
    const use = log.filter(r => new Date(r.timestamp).getTime() >= dayAgo);
    const rows = use.length ? use : log;

    const total = rows.length;
    const passes = rows.filter(r => r.status === 'pass').length;
    const passRate = total ? ((passes/total)*100).toFixed(1)+'%' : '—';
    const avgScore = total ? (rows.reduce((a,b)=>a+(+b.score||0),0)/total).toFixed(2) : '—';
    const last = rows[rows.length-1] || {};

    document.getElementById('totalRuns').textContent = total || '0';
    document.getElementById('passRate').textContent = passRate;
    document.getElementById('avgScore').textContent = avgScore;
    document.getElementById('lastPhase').textContent = last.phase || '—';

    const phases = ['Warm-up','Strength','Endurance','Competition'];
    const stats = {}; phases.forEach(p => stats[p]={runs:0,pass:0,score:0});
    rows.forEach(r => {
      const p=r.phase||'Unknown';
      stats[p] ??= {runs:0,pass:0,score:0};
      stats[p].runs++; stats[p].pass += (r.status==='pass'); stats[p].score += (+r.score||0);
    });
    const tb = document.querySelector('#phaseTable tbody'); tb.innerHTML='';
    [...phases, ...Object.keys(stats).filter(k=>!phases.includes(k))].forEach(p=>{
      const s=stats[p]; if(!s||!s.runs) return;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${p}</td><td>${s.runs}</td><td>${((s.pass/s.runs)*100).toFixed(1)}%</td><td>${(s.score/s.runs).toFixed(2)}</td>`;
      tb.appendChild(tr);
    });

    const comp = rows.filter(r => r.phase==='Competition');
    if (comp.length) {
      comp.sort((a,b)=>(b.score||0)-(a.score||0));
      const best=comp[0];
      const trace=best.trace||best.reasoning||best.note||'(trace not captured)';
      document.getElementById('bestComp').textContent =
        `Time: ${best.timestamp}\nScore: ${best.score}\nRetries: ${best.retries||0}\nTrace: ${trace}`;
    }
  } catch {
    document.getElementById('bestComp').textContent='No data yet.';
  }
}
loadData();
setInterval(loadData, 60_000);
</script>
<script>
async function loadSystemGains() {
  try {
    const res = await fetch('data/system_metrics.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('system_metrics.json not found');
    const d = await res.json();

    // turn status dot green if this loads fine (works even if agi_benchmark_log is delayed)
    const statusDot = document.querySelector('#status-dot');
    const statusText = document.querySelector('#status-text');
    if (statusDot) statusDot.style.background = '#2ecc71';
    if (statusText) statusText.textContent = 'Status: live';

    // find a root container; fall back to body
    const root = document.querySelector('#root') || document.body;

    // make a pretty section
    const card = document.createElement('section');
    card.style.marginTop = '24px';
    card.innerHTML = `
      <h2>System Gains</h2>
      <div><b>Model:</b> ${d.model}</div>
      <div><b>Accuracy:</b> ${Number(d.metrics.accuracy_pct).toFixed(1)}%</div>
      <div><b>Latency:</b> ${d.metrics.inference_latency_ms} ms</div>
      <div><b>Train Time:</b> ${d.metrics.train_time_hours} h</div>
      <div><b>Compute:</b> ${d.metrics.compute_tflops} TFLOPS</div>
      <div><b>Energy Cost:</b> $${d.metrics.energy_cost_per_million_usd}/M queries</div>

      <h3 style="margin-top:1rem">Competitor Delta</h3>
      <table border="0" cellspacing="0" cellpadding="6" style="border-collapse:collapse">
        <thead>
          <tr>
            <th align="left">Model</th>
            <th align="right">Acc%</th>
            <th align="right">Latency</th>
            <th align="right">Train h</th>
            <th align="right">TFLOPS</th>
            <th align="right">$ /M</th>
          </tr>
        </thead>
        <tbody>
          ${Array.isArray(d.comparisons) ? d.comparisons.map(c => `
            <tr>
              <td>${c.name}</td>
              <td align="right">${c.accuracy_pct}</td>
              <td align="right">${c.latency_ms} ms</td>
              <td align="right">${c.train_hours}</td>
              <td align="right">${c.tflops}</td>
              <td align="right">$${c.energy_cost_usd}</td>
            </tr>`).join('') : ''}
        </tbody>
      </table>
      <div style="font-size:0.9em;margin-top:6px;color:#555">
        Updated: ${new Date(d.updated_at).toLocaleString()}
      </div>
    `;
    root.appendChild(card);
  } catch (e) {
    console.warn('System gains not loaded:', e.message);
    const statusDot = document.querySelector('#status-dot');
    const statusText = document.querySelector('#status-text');
    if (statusDot) statusDot.style.background = '#95a5a6';
    if (statusText) statusText.textContent = 'Status: delayed';
  }
}
loadSystemGains();
setInterval(loadSystemGains, 60_000);
</script>
</body>
</html>
